{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { mapState, mapMutations } from \"vuex\";\nimport Token from \"./Token\";\nimport TokenBlock from \"./TokenBlock\";\nimport ClassesBlock from \"./ClassesBlock.vue\";\nimport TokenManager from \"./token-manager\";\nimport TreebankTokenizer from \"treebank-tokenizer\";\nexport default {\n  name: \"AnnotationPage\",\n  data: function () {\n    return {\n      tm: new TokenManager([]),\n      currentSentence: {},\n      redone: \"\",\n      tokenizer: new TreebankTokenizer()\n    };\n  },\n  components: {\n    Token,\n    TokenBlock,\n    ClassesBlock\n  },\n  computed: {\n    ...mapState([\"annotations\", \"classes\", \"currentClass\", \"currentIndex\", \"inputSentences\", \"enableKeyboardShortcuts\", \"annotationPrecision\"])\n  },\n  watch: {\n    inputSentences() {\n      this.resetIndex();\n      this.tokenizeCurrentSentence();\n    },\n    annotations() {\n      if (this.currentAnnotation != this.annotations[this.currentIndex]) {\n        this.tokenizeCurrentSentence();\n      }\n    },\n    classes() {\n      this.tokenizeCurrentSentence();\n    },\n    annotationPrecision() {\n      this.tokenizeCurrentSentence();\n    }\n  },\n  created() {\n    if (this.inputSentences.length) {\n      this.tokenizeCurrentSentence();\n    }\n    document.addEventListener(\"mouseup\", this.selectTokens);\n    document.addEventListener('keydown', this.keypress);\n  },\n  beforeUnmount() {\n    document.removeEventListener(\"mouseup\", this.selectTokens);\n    document.removeEventListener(\"keydown\", this.keypress);\n  },\n  methods: {\n    ...mapMutations([\"nextSentence\", \"previousSentence\", \"resetIndex\"]),\n    keypress(event) {\n      if (!this.enableKeyboardShortcuts) {\n        return;\n      }\n      if (event.keyCode == 32) {\n        // Space\n        this.saveTags();\n      } else if (event.keyCode == 39) {\n        // right arrow\n        this.skipCurrentSentence();\n      } else if (event.keyCode == 37) {\n        // left arrow\n        this.backOneSentence();\n      } else if (event.keyCode == 82 || event.keyCode == 27) {\n        // r / R or ESC\n        this.resetBlocks();\n      }\n      // stop event from bubbling up\n      event.stopPropagation();\n    },\n    tokenizeCurrentSentence() {\n      this.currentSentence = this.inputSentences[this.currentIndex];\n      this.currentAnnotation = this.annotations[this.currentIndex];\n      let tokens, spans;\n      if (this.$store.state.annotationPrecision == \"char\") {\n        tokens = this.currentSentence.text.split('');\n        spans = [];\n        for (let i = 0; i < this.currentSentence.text.length; i++) {\n          spans.push([i, i + 1]);\n        }\n      } else {\n        tokens = this.tokenizer.tokenize(this.currentSentence.text);\n        spans = this.tokenizer.span_tokenize(this.currentSentence.text);\n      }\n      let combined = tokens.map((t, i) => [spans[i][0], spans[i][1], t]);\n      this.tm = new TokenManager(this.classes);\n      this.tm.setTokensAndAnnotation(combined, this.currentAnnotation);\n    },\n    selectTokens() {\n      let selection = document.getSelection();\n      if (selection.anchorOffset === selection.focusOffset && selection.anchorNode === selection.focusNode) {\n        return;\n      }\n      const rangeStart = selection.getRangeAt(0);\n      const rangeEnd = selection.getRangeAt(selection.rangeCount - 1);\n      let start, end;\n      try {\n        start = parseInt(rangeStart.startContainer.parentElement.id.replace(\"t\", \"\"));\n        let offsetEnd = parseInt(rangeEnd.endContainer.parentElement.id.replace(\"t\", \"\"));\n        end = offsetEnd + rangeEnd.endOffset;\n      } catch {\n        console.log(\"selected text were not tokens\");\n        return;\n      }\n      if (!this.classes.length && selection.anchorNode) {\n        alert(\"There are no Tags available. Kindly add some Tags before tagging.\");\n        selection.empty();\n        return;\n      }\n      this.tm.addNewBlock(start, end, this.currentClass);\n      selection.empty();\n    },\n    onRemoveBlock(blockStart) {\n      this.tm.removeBlock(blockStart);\n    },\n    resetBlocks() {\n      this.tm.resetBlocks();\n    },\n    skipCurrentSentence() {\n      this.nextSentence();\n      this.tokenizeCurrentSentence();\n    },\n    backOneSentence() {\n      this.previousSentence();\n      this.tokenizeCurrentSentence();\n    },\n    saveTags() {\n      this.$store.commit(\"addAnnotation\", {\n        text: this.currentSentence.text,\n        entities: this.tm.exportAsAnnotation()\n      });\n      this.nextSentence();\n      this.tokenizeCurrentSentence();\n    }\n  }\n};","map":{"version":3,"names":["mapState","mapMutations","Token","TokenBlock","ClassesBlock","TokenManager","TreebankTokenizer","name","data","tm","currentSentence","redone","tokenizer","components","computed","watch","inputSentences","resetIndex","tokenizeCurrentSentence","annotations","currentAnnotation","currentIndex","classes","annotationPrecision","created","length","document","addEventListener","selectTokens","keypress","beforeUnmount","removeEventListener","methods","event","enableKeyboardShortcuts","keyCode","saveTags","skipCurrentSentence","backOneSentence","resetBlocks","stopPropagation","tokens","spans","$store","state","text","split","i","push","tokenize","span_tokenize","combined","map","t","setTokensAndAnnotation","selection","getSelection","anchorOffset","focusOffset","anchorNode","focusNode","rangeStart","getRangeAt","rangeEnd","rangeCount","start","end","parseInt","startContainer","parentElement","id","replace","offsetEnd","endContainer","endOffset","console","log","alert","empty","addNewBlock","currentClass","onRemoveBlock","blockStart","removeBlock","nextSentence","previousSentence","commit","entities","exportAsAnnotation"],"sources":["C:\\Users\\Filip\\GIT_PROJECTS\\annotator_with_packages\\src\\components\\AnnotationPage.vue"],"sourcesContent":["<template>\r\n  <div>\r\n    <classes-block />\r\n    <div class=\"q-pa-lg\" style=\"height:60vh; overflow-y:scroll;\">\r\n      <component\r\n        :is=\"t.type === 'token' ? 'Token' : 'TokenBlock'\"\r\n        :id=\"'t' + t.start\"\r\n        v-for=\"t in tm.tokens\"\r\n        :token=\"t\"\r\n        :key=\"t.start\"\r\n        :backgroundColor=\"t.backgroundColor\"\r\n        @remove-block=\"onRemoveBlock\"\r\n      />\r\n    </div>\r\n\r\n    <div class=\"q-pa-md\" style=\"border-top: 1px solid #ccc\">\r\n      <q-btn\r\n        color=\"red\"\r\n        outline\r\n        class=\"q-mx-md\"\r\n        @click=\"resetBlocks\"\r\n        label=\"Reset\"\r\n      />\r\n      <q-btn\r\n        class=\"q-mx-md\"\r\n        outline\r\n        @click=\"backOneSentence\"\r\n        :disabled=\"currentIndex == 0\"\r\n        label=\"Back\"\r\n      />\r\n      <q-btn\r\n        class=\"q-mx-md\"\r\n        outline\r\n        @click=\"skipCurrentSentence\"\r\n        label=\"Skip\"\r\n      />\r\n      <q-btn\r\n        class=\"q-mx-md\"\r\n        color=\"green\"\r\n        outline\r\n        @click=\"saveTags\"\r\n        label=\"Save\"\r\n      />\r\n    </div>\r\n  </div>\r\n</template>\r\n<script>\r\nimport { mapState, mapMutations } from \"vuex\";\r\nimport Token from \"./Token\";\r\nimport TokenBlock from \"./TokenBlock\";\r\nimport ClassesBlock from \"./ClassesBlock.vue\";\r\nimport TokenManager from \"./token-manager\";\r\nimport TreebankTokenizer from \"treebank-tokenizer\";\r\n\r\nexport default {\r\n  name: \"AnnotationPage\",\r\n  data: function() {\r\n    return {\r\n      tm: new TokenManager([]),\r\n      currentSentence: {},\r\n      redone: \"\",\r\n      tokenizer: new TreebankTokenizer(),\r\n    };\r\n  },\r\n  components: {\r\n    Token,\r\n    TokenBlock,\r\n    ClassesBlock,\r\n  },\r\n  computed: {\r\n    ...mapState([\r\n      \"annotations\",\r\n      \"classes\",\r\n      \"currentClass\",\r\n      \"currentIndex\",\r\n      \"inputSentences\",\r\n      \"enableKeyboardShortcuts\",\r\n      \"annotationPrecision\",\r\n    ]),\r\n  },\r\n  watch: {\r\n    inputSentences() {\r\n      this.resetIndex();\r\n      this.tokenizeCurrentSentence();\r\n    },\r\n    annotations() {\r\n      if (this.currentAnnotation != this.annotations[this.currentIndex]) {\r\n        this.tokenizeCurrentSentence();\r\n      }\r\n    },\r\n    classes() {\r\n      this.tokenizeCurrentSentence();\r\n    },\r\n    annotationPrecision() {\r\n      this.tokenizeCurrentSentence();\r\n    }\r\n  },\r\n  created() {\r\n    if (this.inputSentences.length) {\r\n      this.tokenizeCurrentSentence();\r\n    }\r\n    document.addEventListener(\"mouseup\", this.selectTokens);\r\n    document.addEventListener('keydown', this.keypress);\r\n  },\r\n  beforeUnmount() {\r\n    document.removeEventListener(\"mouseup\", this.selectTokens);\r\n    document.removeEventListener(\"keydown\", this.keypress);\r\n  },\r\n  methods: {\r\n    ...mapMutations([\"nextSentence\", \"previousSentence\", \"resetIndex\"]),\r\n    keypress(event) {\r\n      if (!this.enableKeyboardShortcuts) {\r\n        return\r\n      }\r\n      if (event.keyCode == 32) { // Space\r\n        this.saveTags();\r\n      } else if (event.keyCode == 39) { // right arrow\r\n        this.skipCurrentSentence();\r\n      } else if (event.keyCode == 37) { // left arrow\r\n        this.backOneSentence();\r\n      } else if (event.keyCode == 82 || event.keyCode == 27) { // r / R or ESC\r\n        this.resetBlocks();\r\n      }\r\n      // stop event from bubbling up\r\n      event.stopPropagation()\r\n    },\r\n    tokenizeCurrentSentence() {\r\n      this.currentSentence = this.inputSentences[this.currentIndex];\r\n      this.currentAnnotation = this.annotations[this.currentIndex];\r\n\r\n      let tokens, spans;\r\n\r\n      if (this.$store.state.annotationPrecision == \"char\") {\r\n        tokens = this.currentSentence.text.split('');\r\n        spans = []\r\n        for (let i = 0; i < this.currentSentence.text.length; i++) {\r\n          spans.push([i, i + 1]);\r\n        }\r\n      } else {\r\n        tokens = this.tokenizer.tokenize(this.currentSentence.text);\r\n        spans = this.tokenizer.span_tokenize(this.currentSentence.text);\r\n      }\r\n\r\n      let combined = tokens.map((t, i) => [spans[i][0], spans[i][1], t]);\r\n\r\n      this.tm = new TokenManager(this.classes);\r\n      this.tm.setTokensAndAnnotation(combined, this.currentAnnotation);\r\n    },\r\n    selectTokens() {\r\n      let selection = document.getSelection();\r\n\r\n      if (\r\n        selection.anchorOffset === selection.focusOffset &&\r\n        selection.anchorNode === selection.focusNode\r\n      ) {\r\n        return;\r\n      }\r\n      \r\n      const rangeStart = selection.getRangeAt(0);\r\n      const rangeEnd = selection.getRangeAt(selection.rangeCount - 1);\r\n      let start, end;\r\n      try {\r\n        start = parseInt(rangeStart.startContainer.parentElement.id.replace(\"t\", \"\"));\r\n        let offsetEnd = parseInt(rangeEnd.endContainer.parentElement.id.replace(\"t\", \"\"));\r\n        end = offsetEnd + rangeEnd.endOffset;\r\n      } catch {\r\n        console.log(\"selected text were not tokens\");\r\n        return;\r\n      }\r\n\r\n      if (!this.classes.length && selection.anchorNode) {\r\n        alert(\r\n          \"There are no Tags available. Kindly add some Tags before tagging.\"\r\n        );\r\n        selection.empty();\r\n        return;\r\n      }\r\n      \r\n      this.tm.addNewBlock(start, end, this.currentClass);\r\n      selection.empty();\r\n    },\r\n    onRemoveBlock(blockStart) {\r\n      this.tm.removeBlock(blockStart);\r\n    },\r\n    resetBlocks() {\r\n      this.tm.resetBlocks();\r\n    },\r\n    skipCurrentSentence() {\r\n      this.nextSentence();\r\n      this.tokenizeCurrentSentence();\r\n    },\r\n    backOneSentence() {\r\n      this.previousSentence();\r\n      this.tokenizeCurrentSentence();\r\n    },\r\n    saveTags() {\r\n      this.$store.commit(\"addAnnotation\", {\r\n        text: this.currentSentence.text,\r\n        entities: this.tm.exportAsAnnotation(),\r\n      });\r\n      this.nextSentence();\r\n      this.tokenizeCurrentSentence();\r\n    },\r\n  },\r\n};\r\n</script>\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}